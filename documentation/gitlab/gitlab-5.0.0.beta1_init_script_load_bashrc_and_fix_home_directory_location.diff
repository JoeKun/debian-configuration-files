--- init.d-orig/gitlab	2013-03-18 01:05:45.979349783 -0700
+++ init.d/gitlab	2013-03-17 21:04:17.641004685 -0700
@@ -15,7 +15,7 @@
 ### END INIT INFO
 
 
-APP_ROOT="/home/git/gitlab"
+APP_ROOT="/var/lib/git/gitlab"
 DAEMON_OPTS="-c $APP_ROOT/config/unicorn.rb -E production"
 PID_PATH="$APP_ROOT/tmp/pids"
 UNICORN_PID="$PID_PATH/unicorn.pid"
@@ -45,8 +45,8 @@
     exit 1
   else
     if [ `whoami` = root ]; then
-      sudo -u git -H bash -l -c "nohup bundle exec unicorn_rails $DAEMON_OPTS  > /dev/null  2>&1 &"
-      sudo -u git -H bash -l -c "mkdir -p $PID_PATH && $START_SIDEKIQ  > /dev/null  2>&1 &"
+      sudo -u git -H bash -l -c ". ~/.bashrc ; nohup bundle exec unicorn_rails $DAEMON_OPTS  > /dev/null  2>&1 &"
+      sudo -u git -H bash -l -c ". ~/.bashrc ; mkdir -p $PID_PATH && $START_SIDEKIQ  > /dev/null  2>&1 &"
       echo "$DESC started"
     fi
   fi
@@ -58,7 +58,7 @@
   if [ "$PID" -ne 0 -a "$STATUS" -ne 0 ]; then
     ## Program is running, stop it.
     kill -QUIT `cat $UNICORN_PID`
-    sudo -u git -H bash -l -c "mkdir -p $PID_PATH && $STOP_SIDEKIQ  > /dev/null  2>&1 &"
+    sudo -u git -H bash -l -c ". ~/.bashrc ; mkdir -p $PID_PATH && $STOP_SIDEKIQ  > /dev/null  2>&1 &"
     rm "$UNICORN_PID" >> /dev/null
     echo "$DESC stopped"
   else
@@ -74,9 +74,9 @@
   if [ "$PID" -ne 0 -a "$STATUS" -ne 0 ]; then
     echo "Restarting $DESC..."
     kill -USR2 `cat $UNICORN_PID`
-    sudo -u git -H bash -l -c "mkdir -p $PID_PATH && $STOP_SIDEKIQ  > /dev/null  2>&1 &"
+    sudo -u git -H bash -l -c ". ~/.bashrc ; mkdir -p $PID_PATH && $STOP_SIDEKIQ  > /dev/null  2>&1 &"
     if [ `whoami` = root ]; then
-      sudo -u git -H bash -l -c "mkdir -p $PID_PATH && $START_SIDEKIQ  > /dev/null  2>&1 &"
+      sudo -u git -H bash -l -c ". ~/.bashrc ; mkdir -p $PID_PATH && $START_SIDEKIQ  > /dev/null  2>&1 &"
     fi
     echo "$DESC restarted."
   else
